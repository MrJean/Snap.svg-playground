<html>
    <head>
        <title>Windspeed</title>
        <style type="text/css">
            svg { max-width: 100px; }
        </style>
    </head>
    <body>
        <svg id="windmill"></svg>
        <svg id="windmillYellow"></svg>
        <svg id="windmillRed"></svg>
        <svg id="thermometer"></svg>
        <svg id="windmeter"></svg>
        <svg id="humidity"></svg>
        
        <br /><button onclick="windmill.changeSpeed(Math.floor(Math.random() * 10) * 1000)">Change speed</button>
        <br /><button onclick="thermometer.changeTemperature()">Change temperature</button>
        <br /><button onclick="windmeter.changeBeaufort()">Change beaufort</button>
        <br /><button onclick="humidity.changeHumidity()">Change humidity</button>

        <script src="scripts/snap.svg-min.js"></script>
        <script src="scripts/windmill.snapsvg.js"></script>

        <script>
            
            (function() {
                
                var windmillGray = new Windmill({
                    fill: '#999',
                    speed: 10000
                });
                
                var windmillYellow = new Windmill({
                    element: '#windmillYellow',
                    fill: 'Yellow',
                    speed: 4000
                });

                var windmillRed = new Windmill({
                    element: '#windmillRed',
                    fill: 'Red',
                    speed: 3000
                });
                
                // ***
                // Thermometer
                // ***
                thermometer = (function() {
                    
                    var thermometer = Snap("#thermometer");
                    thermometer.attr({ viewBox: "0 0 100 100" });
                    
                    thermometer.path("M43,30 A6,6 45 1,1 55,30 L55,50 A12,12 0 1,1 43,50 L43,30 z").attr({
                        stroke: '#000',
                        strokeWidth: 2,
                        fill: 'none'
                    });
                    thermometer.circle(49, 61, 5);

                    var temperatureBar = thermometer.rect(47, 56, 4, 7, 2);
                    var maxTemperature = 30;
                    var temperature = 20;

                    function animateThermometer(temperature) {
                        if (temperature > maxTemperature) {
                            temperature = maxTemperature;
                        }

                        temperatureBar.animate({
                            y: 27 + (maxTemperature - temperature),
                            height: 36 - (maxTemperature - temperature)
                        }, 1000);
                    }
                    
                    return {
                        draw : function() {
                            animateThermometer(temperature);
                        },
                        
                        changeTemperature : function() {
                            var newTemperature = Math.floor(Math.random() * 30);
                            animateThermometer(newTemperature);
                        }
                    }
                    
                })();
                
                thermometer.draw();
                
                // ***
                // Windmeter
                // ***
                
                windmeter = (function() {
                    
                    var flag = undefined;
                    var flagAnimationSpeed = ['r0', 'r10', 'r20'];
                    var beaufort = 2;
                    
                    function drawWindmeter() {
                        var windmeter = Snap("#windmeter");
                        windmeter.attr({ viewBox: "0 0 100 100" });
                        
                        var pole = windmeter.rect(30, 25, 2, 50);
                        
                        var flagPart1 = windmeter.rect(35, 19, 3, 15);
                        var flagPart2 = windmeter.path("M45,20 L55,21 L55,32 L45,33 z").attr({
                            fill: '#000'
                        });
                        var flagPart3 = windmeter.rect(63, 22, 3, 9);
                        var flagTop = windmeter.line(35, 19, 66, 22).attr({
                            stroke: '#000',
                            strokeWidth: '1'
                        });
                        var flagBottom = windmeter.line(35, 34, 66, 31).attr({
                            stroke: '#000',
                            strokeWidth: '1'
                        });
                        flag = windmeter.g(flagPart1, flagPart2, flagPart3, flagTop, flagBottom);
                        animateFlag();
                    }
                    
                    function animateFlag() {
                        flag.stop().animate(
                            {
                                transform: flagAnimationSpeed[beaufort] + ', 35, 18'
                            },
                            1000
                        );
                    }

                    return {
                        draw : function() {
                            drawWindmeter();
                        },
                        
                        changeBeaufort : function() {
                            beaufort = Math.floor(Math.random() * 3);
                            animateFlag();
                        }
                    }
                    
                })();
                
                windmeter.draw();
                
                // ***
                // Humidity
                // ***
                humidity = (function() {
                    
                    var humimdity = 0;
                    var drop = undefined;
                    var dropsPos = [
                        [ 't25,-2s,s0.55,0.55', 't25,0s,s0.55,0.55' ],
                        [ 't12,-27s,s0.7,0.7', 't12,-25s,s0.7,0.7' ], 
                        [ 't-10,-10s,s0.6,0.6', 't-10,-8s,s0.6,0.6' ]
                    ];
                    var drops = [];
                    
                    function drawDrop() {
                        var surface = Snap("#humidity");
                        surface.attr({ viewBox: "0 0 100 100" });
                        
                        drop = surface.path("M30,50 A11,11 0 1,0 50,50 L40,35 z").attr({
                            stroke: '#000',
                            strokeWidth: 2,
                            fill: 'none'
                        });
                    }
                    
                    function clearHumidity() {
                        for (i = 0; i < drops.length; i++) {
                            drops[i].animate({
                                strokeWidth: 0
                            }, 100, function() {
                                this.remove();
                            });
                        }
                    }
                    
                    function adjustHumidity() {
                        clearHumidity();
                        for (i = 0; i < humimdity; i++) {
                            var extraDrop = drop.clone();
                            drops[i] = extraDrop;
                            extraDrop.attr({
                                transform: dropsPos[i][0],
                                strokeWidth: 0
                            }).animate({
                                transform: dropsPos[i][1],
                                strokeWidth: 2
                            }, 1000);
                        }
                    }
                    
                    return {
                        draw : function() {
                            drawDrop();
                        },
                        
                        changeHumidity : function() {
                            humimdity = Math.floor(Math.random() * 4);
                            adjustHumidity();
                        }
                    }
                    
                })();
                
                humidity.draw();
                
            })();            
            
        </script>
    </body>
</html>