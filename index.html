<html>
    <head>
        <title>Windspeed</title>
        <style type="text/css">
            svg { max-width: 100px; }
        </style>
    </head>
    <body>
        <svg id="windspeed"></svg>
        <svg id="thermometer"></svg>
        <svg id="windmeter"></svg>
        <svg id="humidity"></svg>
        
        <br /><button onclick="windmill.changeSpeed()">Change speed</button>
        <br /><button onclick="thermometer.changeTemperature()">Change temperature</button>
        <br /><button onclick="windmeter.changeBeaufort()">Change beaufort</button>
        <br /><button onclick="humidity.changeHumidity()">Change humidity</button>

        <script src="snap.svg-min.js"></script>

        <script>
            
            (function() {

                // ***
                // Windmill
                // ***
                windmill = (function() {
                    
                    var s = Snap("#windspeed");
                    s.attr({ viewBox: "0 0 100 100" });
                    
                    var blades = {
                        blade1 : { transform: 'r30 50 50', rotation: 'r390,50,50' },
                        blade2 : { transform: 'r150 50 50' },
                        blade3 : { transform: 'r270 50 50' }
                    }
                    var windmillSpeed = 3000;
                    var ringGroup = undefined;
                    var bladeGroup = undefined;
                    var windmill = undefined;
                    
                    function drawRings() {
                        var ringMask = s.path("M37,48 L8,67 L10,10 L44,10 L42,30 z").attr({
                            fill: '#fff'
                        });
                        var outerRing = s.circle(50, 50, 30);
                        outerRing.attr({
                            stroke: "#000",
                            strokeWidth: 3,
                            fill: 'none'
                        });
                        var innerRing = s.circle(50, 50, 22);
                        innerRing.attr({
                            stroke: "#000",
                            strokeWidth: 3,
                            fill: 'none'
                        });
                        var ringPart1= s.g(outerRing, innerRing);
                        ringPart1.attr({
                            mask: ringMask
                        });
                        var ringPart2 = ringPart1.clone().attr({
                            transform: 'r120 50 50'
                        });
                        var ringPart3 = ringPart1.clone().attr({
                            transform: 'r240 50 50'
                        });
                        ringGroup = s.g(ringPart1, ringPart2, ringPart3);
                    }

                    function drawBlades() {
                        var blade1 = s.ellipse(70, 50, 20, 5);
                        blade1.attr({
                            transform: blades.blade1.transform
                        });
                        var blade2 = blade1.clone();
                        blade2.attr({
                            transform: blades.blade2.transform
                        });
                        var blade3 = blade1.clone();
                        blade3.attr({
                            transform: blades.blade3.transform
                        });
                        bladeGroup = s.g(blade1, blade2, blade3);
                    }
                    
                    function mergeWindmill() {
                        var motor = s.circle(50, 50, 8);
                        windmill = s.g(ringGroup, bladeGroup, motor);
                    }

                    function animateWindmill() {
                        windmill.stop().animate({
                            transform: blades.blade1.rotation
                        }, 
                        windmillSpeed, 
                        function() {
                            windmill.transform(blades.blade1.transform);
                            animateWindmill();
                        });
                    }
                    
                    return {
                        draw : function() {
                            drawRings();
                            drawBlades();
                            mergeWindmill();
                            animateWindmill();
                        },
                        changeSpeed : function() {
                            windmillSpeed = Math.floor(Math.random() * 10) * 1000;
                        }
                    }
                    
                })();
                
                windmill.draw();
                
                // ***
                // Thermometer
                // ***
                thermometer = (function() {
                    
                    var thermometer = Snap("#thermometer");
                    thermometer.attr({ viewBox: "0 0 100 100" });
                    
                    thermometer.path("M43,30 A6,6 45 1,1 55,30 L55,50 A12,12 0 1,1 43,50 L43,30 z").attr({
                        stroke: '#000',
                        strokeWidth: 2,
                        fill: 'none'
                    });
                    thermometer.circle(49, 61, 5);

                    var temperatureBar = thermometer.rect(47, 56, 4, 7, 2);
                    var maxTemperature = 30;
                    var temperature = 20;

                    function animateThermometer(temperature) {
                        if (temperature > maxTemperature) {
                            temperature = maxTemperature;
                        }

                        temperatureBar.animate({
                            y: 27 + (maxTemperature - temperature),
                            height: 36 - (maxTemperature - temperature)
                        }, 1000);
                    }
                    
                    return {
                        draw : function() {
                            animateThermometer(temperature);
                        },
                        
                        changeTemperature : function() {
                            var newTemperature = Math.floor(Math.random() * 30);
                            animateThermometer(newTemperature);
                        }
                    }
                    
                })();
                
                thermometer.draw();
                
                // ***
                // Windmeter
                // ***
                
                windmeter = (function() {
                    
                    var flag = undefined;
                    var flagAnimationSpeed = ['r0', 'r10', 'r20'];
                    var beaufort = 2;
                    
                    function drawWindmeter() {
                        var windmeter = Snap("#windmeter");
                        windmeter.attr({ viewBox: "0 0 100 100" });
                        
                        var pole = windmeter.rect(30, 25, 2, 50);
                        
                        var flagPart1 = windmeter.rect(35, 19, 3, 15);
                        var flagPart2 = windmeter.path("M45,20 L55,21 L55,32 L45,33 z").attr({
                            fill: '#000'
                        });
                        var flagPart3 = windmeter.rect(63, 22, 3, 9);
                        var flagTop = windmeter.line(35, 19, 66, 22).attr({
                            stroke: '#000',
                            strokeWidth: '1'
                        });
                        var flagBottom = windmeter.line(35, 34, 66, 31).attr({
                            stroke: '#000',
                            strokeWidth: '1'
                        });
                        flag = windmeter.g(flagPart1, flagPart2, flagPart3, flagTop, flagBottom);
                        animateFlag();
                    }
                    
                    function animateFlag() {
                        flag.stop().animate(
                            {
                                transform: flagAnimationSpeed[beaufort] + ', 35, 18'
                            },
                            1000
                        );
                    }

                    return {
                        draw : function() {
                            drawWindmeter();
                        },
                        
                        changeBeaufort : function() {
                            beaufort = Math.floor(Math.random() * 3);
                            animateFlag();
                        }
                    }
                    
                })();
                
                windmeter.draw();
                
                // ***
                // Humidity
                // ***
                humidity = (function() {
                    
                    var humimdity = 0;
                    var drop = undefined;
                    var dropsPos = [
                        [ 't25,-2s,s0.55,0.55', 't25,0s,s0.55,0.55' ],
                        [ 't12,-27s,s0.7,0.7', 't12,-25s,s0.7,0.7' ], 
                        [ 't-10,-10s,s0.6,0.6', 't-10,-8s,s0.6,0.6' ]
                    ];
                    var drops = [];
                    
                    function drawDrop() {
                        var surface = Snap("#humidity");
                        surface.attr({ viewBox: "0 0 100 100" });
                        
                        drop = surface.path("M30,50 A11,11 0 1,0 50,50 L40,35 z").attr({
                            stroke: '#000',
                            strokeWidth: 2,
                            fill: 'none'
                        });
                    }
                    
                    function clearHumidity() {
                        for (i = 0; i < drops.length; i++) {
                            drops[i].animate({
                                strokeWidth: 0
                            }, 100, function() {
                                this.remove();
                            });
                        }
                    }
                    
                    function adjustHumidity() {
                        clearHumidity();
                        for (i = 0; i < humimdity; i++) {
                            var extraDrop = drop.clone();
                            drops[i] = extraDrop;
                            extraDrop.attr({
                                transform: dropsPos[i][0],
                                strokeWidth: 0
                            }).animate({
                                transform: dropsPos[i][1],
                                strokeWidth: 2
                            }, 1000);
                        }
                    }
                    
                    return {
                        draw : function() {
                            drawDrop();
                        },
                        
                        changeHumidity : function() {
                            humimdity = Math.floor(Math.random() * 4);
                            adjustHumidity();
                        }
                    }
                    
                })();
                
                humidity.draw();
                
            })();            
            
        </script>
    </body>
</html>